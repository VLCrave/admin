<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VLStore - Delivery & Digital Services</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #ff5e00 0%, #ff2e00 100%);
        }
        
        .category-card {
            transition: all 0.3s ease;
        }
        
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .product-card {
            transition: all 0.3s ease;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .promo-fomo {
            background: linear-gradient(135deg, #ff4444 0%, #ff2e00 100%);
        }
        
        .discount-badge {
            background: linear-gradient(135deg, #ff4444 0%, #ff2e00 100%);
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .tab-active {
            border-bottom: 3px solid #ff2e00;
            color: #ff2e00;
            font-weight: 600;
        }
        
        .promo-popup {
            animation: slideInDown 0.5s ease-out;
        }
        
        @keyframes slideInDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .checkout-step {
            transition: all 0.3s ease;
        }
        
        .checkout-step.active {
            background-color: rgba(255, 46, 0, 0.1);
            border-color: #ff2e00;
        }
        
        .location-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        #map {
            height: 400px;
            width: 100%;
            border-radius: 0.5rem;
            z-index: 1;
        }
        
        .leaflet-container {
            font-family: 'Poppins', sans-serif;
        }
        
        .custom-marker {
            background: #ff2e00;
            border: 3px solid #fff;
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .map-container {
            position: relative;
        }
        
        .map-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .shipping-info {
            background: #f8fafc;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .fomo-badge {
            background: linear-gradient(135deg, #ff6b00 0%, #ff2e00 50%, #cc0000 100%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .store-badge {
            background: linear-gradient(135deg, #0066cc 0%, #004499 100%);
        }
        
        .store-badge.indomaret {
            background: linear-gradient(135deg, #cc0000 0%, #990000 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Firebase Configuration -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDqigW41nufIzMOtxHjcAN7ZRLFNokHDS0",
            authDomain: "vlonline.firebaseapp.com",
            projectId: "vlonline",
            storageBucket: "vlonline.firebasestorage.app",
            messagingSenderId: "860419602853",
            appId: "1:860419602853:web:9f68d7ca09305293ab104c",
            measurementId: "G-0QVS1K2BHL"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
    </script>

    <!-- Promo Popup -->
    <div id="promo-popup" class="promo-popup fixed top-0 left-0 right-0 gradient-bg text-white py-2 z-50 hidden">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-gift"></i>
                <span class="font-medium">Gratis Ongkir dengan VLCrave Express! Min. belanja Rp 50rb</span>
            </div>
            <button id="close-popup" class="text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Header -->
    <header class="sticky-header bg-white shadow-md">
        <!-- Top Header -->
        <div class="gradient-bg text-white py-2 hidden md:block">
            <div class="container mx-auto px-4 flex justify-between items-center">
                <div class="flex items-center space-x-6 text-sm">
                    <span><i class="fas fa-headset mr-1"></i> Pusat Bantuan</span>
                    <span><i class="fas fa-truck mr-1"></i> Lacak Pesanan</span>
                    <span><i class="fas fa-download mr-1"></i> Download App</span>
                </div>
                <div class="flex items-center space-x-4 text-sm">
                    <span id="user-location" class="flex items-center">
                        <i class="fas fa-map-marker-alt mr-1"></i>
                        <span>Lokasi: Detecting...</span>
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Main Header -->
        <div class="bg-white py-4">
            <div class="container mx-auto px-4">
                <div class="flex items-center justify-between">
                    <!-- Logo -->
                    <div class="flex items-center space-x-2">
                        <div class="gradient-bg text-white p-2 rounded-lg">
                            <i class="fas fa-store text-xl"></i>
                        </div>
                        <span class="text-2xl font-bold text-gray-800">VLStore</span>
                    </div>
                    
                    <!-- Search Bar -->
                    <div class="flex-1 max-w-2xl mx-4">
                        <div class="relative">
                            <input type="text" placeholder="Cari makanan, minuman, pulsa..." class="w-full border border-orange-500 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-orange-300">
                            <button class="absolute right-0 top-0 gradient-bg text-white py-2 px-6 rounded-r-lg">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- User Actions -->
                    <div class="flex items-center space-x-6">
                        <!-- Cart -->
                        <div class="relative">
                            <button id="cart-btn" class="text-gray-700 hover:text-orange-500 transition-colors">
                                <i class="fas fa-shopping-cart text-xl"></i>
                                <span class="cart-badge" id="cart-count">0</span>
                            </button>
                        </div>
                        
                        <!-- User Account -->
                        <div class="relative group">
                            <button class="flex items-center space-x-1 text-gray-700 hover:text-orange-500 transition-colors">
                                <i class="fas fa-user-circle text-xl"></i>
                                <span class="hidden md:inline">Akun</span>
                                <i class="fas fa-chevron-down text-xs"></i>
                            </button>
                            <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 hidden group-hover:block z-10">
                                <a href="#" class="block px-4 py-2 hover:bg-gray-100" id="login-btn">Masuk</a>
                                <a href="#" class="block px-4 py-2 hover:bg-gray-100" id="register-btn">Daftar</a>
                                <a href="#" class="block px-4 py-2 hover:bg-gray-100" id="order-history-btn">Riwayat Pesanan</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Categories Navigation -->
        <div class="border-t border-gray-200 py-2 hidden md:block">
            <div class="container mx-auto px-4">
                <div class="flex items-center space-x-8 overflow-x-auto" id="categories-nav">
                    <!-- Categories will be loaded from Firebase -->
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="min-h-screen">
        <!-- Compact Hero Banner -->
        <section class="relative gradient-bg text-white py-6">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row items-center justify-between">
                    <div class="md:w-2/3 mb-4 md:mb-0">
                        <h1 class="text-2xl md:text-3xl font-bold mb-2">Delivery Cepat & Terpercaya!</h1>
                        <p class="text-lg mb-4">Makanan, minuman, pulsa, e-wallet - Semua ada di VLStore</p>
                        <button class="bg-white text-orange-500 font-bold py-2 px-6 rounded-lg hover:bg-gray-100 transition-colors">
                            Pesan Sekarang
                        </button>
                    </div>
                    <div class="md:w-1/3 flex justify-center">
                        <div class="relative">
                            <div class="text-white text-center">
                                <i class="fas fa-motorcycle text-6xl mb-2"></i>
                                <div class="text-lg font-bold">VLCrave Express</div>
                                <div class="text-sm">Delivery dalam 30 menit</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PROMO FOMO Section -->
        <section class="py-6">
            <div class="container mx-auto px-4">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-2">
                        <div class="fomo-badge text-white py-1 px-3 rounded-lg font-bold">
                            <i class="fas fa-bolt mr-1"></i>PROMO FOMO
                        </div>
                        <h2 class="text-xl font-bold text-gray-800">Jangan Sampai Kehabisan!</h2>
                    </div>
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-clock mr-1"></i>Berakhir dalam 24 jam
                    </div>
                </div>
                
                <!-- FOMO Products -->
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4" id="fomo-products">
                    <!-- FOMO products will be loaded from Firebase -->
                </div>
            </div>
        </section>

        <!-- Categories -->
        <section class="py-6 bg-white">
            <div class="container mx-auto px-4">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Kategori Layanan</h2>
                <div class="grid grid-cols-3 md:grid-cols-5 lg:grid-cols-8 gap-4" id="categories-list">
                    <!-- Categories will be loaded from Firebase -->
                </div>
            </div>
        </section>

        <!-- Products Section -->
        <section class="py-6">
            <div class="container mx-auto px-4">
                <div class="flex border-b border-gray-200 mb-4 overflow-x-auto">
                    <button class="tab-button py-2 px-4 font-medium text-gray-600 hover:text-orange-500 whitespace-nowrap" data-tab="all">Semua Layanan</button>
                    <button class="tab-button py-2 px-4 font-medium text-gray-600 hover:text-orange-500 whitespace-nowrap" data-tab="food">Makanan</button>
                    <button class="tab-button py-2 px-4 font-medium text-gray-600 hover:text-orange-500 whitespace-nowrap" data-tab="drink">Minuman</button>
                    <button class="tab-button py-2 px-4 font-medium text-gray-600 hover:text-orange-500 whitespace-nowrap" data-tab="digital">Digital</button>
                    <button class="tab-button py-2 px-4 font-medium text-gray-600 hover:text-orange-500 whitespace-nowrap" data-tab="popular">Populer</button>
                    <button class="tab-button py-2 px-4 font-medium text-gray-600 hover:text-orange-500 whitespace-nowrap" data-tab="nearby">Terdekat</button>
                </div>
                
                <!-- All Products -->
                <div id="all-tab" class="tab-content">
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4" id="all-products">
                        <!-- Product items will be loaded from Firebase -->
                    </div>
                </div>
                
                <!-- Food Products -->
                <div id="food-tab" class="tab-content hidden">
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4" id="food-products">
                        <!-- Food product items will be loaded from Firebase -->
                    </div>
                </div>
                
                <!-- Drink Products -->
                <div id="drink-tab" class="tab-content hidden">
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4" id="drink-products">
                        <!-- Drink product items will be loaded from Firebase -->
                    </div>
                </div>
                
                <!-- Digital Products -->
                <div id="digital-tab" class="tab-content hidden">
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4" id="digital-products">
                        <!-- Digital product items will be loaded from Firebase -->
                    </div>
                </div>
                
                <!-- Popular Products -->
                <div id="popular-tab" class="tab-content hidden">
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4" id="popular-products">
                        <!-- Popular product items will be loaded from Firebase -->
                    </div>
                </div>
                
                <!-- Nearby Products -->
                <div id="nearby-tab" class="tab-content hidden">
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4" id="nearby-products">
                        <!-- Nearby product items will be loaded from Firebase -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white pt-8 pb-6">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <!-- Company Info -->
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <div class="gradient-bg text-white p-2 rounded-lg">
                            <i class="fas fa-store"></i>
                        </div>
                        <span class="text-xl font-bold">VLStore</span>
                    </div>
                    <p class="text-gray-300 mb-3 text-sm">Layanan delivery makanan, minuman, dan produk digital terpercaya.</p>
                    <div class="flex space-x-3">
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <!-- Layanan -->
                <div>
                    <h3 class="text-lg font-bold mb-3">Layanan Kami</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white text-sm">Makanan Delivery</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white text-sm">Minuman</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white text-sm">Pulsa & Data</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white text-sm">E-Wallet</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white text-sm">Alfamart/Indomaret</a></li>
                    </ul>
                </div>
                
                <!-- Bantuan -->
                <div>
                    <h3 class="text-lg font-bold mb-3">Bantuan</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white text-sm">Pusat Bantuan</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white text-sm">Cara Pesan</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white text-sm">Syarat & Ketentuan</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white text-sm">Kebijakan Privasi</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white text-sm">Hubungi Kami</a></li>
                    </ul>
                </div>
                
                <!-- Pembayaran -->
                <div>
                    <h3 class="text-lg font-bold mb-3">Metode Pembayaran</h3>
                    <div class="grid grid-cols-3 gap-2 mb-4" id="payment-methods">
                        <!-- Payment methods will be loaded from Firebase -->
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-shield-alt text-green-400"></i>
                        <span class="text-sm text-gray-300">Transaksi 100% Aman</span>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 pt-6 text-center">
                <p class="text-gray-400 text-sm">&copy; 2024 VLStore. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-2xl mx-4 max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold">Keranjang Belanja</h3>
                    <button id="close-cart" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto max-h-96">
                <div id="cart-items" class="space-y-4">
                    <!-- Cart items will be loaded here -->
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-shopping-cart text-4xl mb-4"></i>
                        <p>Keranjang belanja Anda kosong</p>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t border-gray-200">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-lg font-semibold">Total:</span>
                    <span class="text-lg font-bold" id="cart-total">Rp 0</span>
                </div>
                <button id="checkout-btn" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity">
                    Checkout Sekarang
                </button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold">Checkout</h3>
                    <button id="close-checkout" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <!-- Checkout Steps -->
                <div class="flex justify-between mb-8">
                    <div class="checkout-step active p-3 border-2 border-orange-500 rounded-lg text-center w-1/3">
                        <div class="w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center mx-auto mb-2">1</div>
                        <span class="font-medium">Informasi</span>
                    </div>
                    <div class="checkout-step p-3 border-2 border-gray-300 rounded-lg text-center w-1/3 mx-2">
                        <div class="w-8 h-8 bg-gray-300 text-white rounded-full flex items-center justify-center mx-auto mb-2">2</div>
                        <span class="font-medium text-gray-500">Lokasi</span>
                    </div>
                    <div class="checkout-step p-3 border-2 border-gray-300 rounded-lg text-center w-1/3">
                        <div class="w-8 h-8 bg-gray-300 text-white rounded-full flex items-center justify-center mx-auto mb-2">3</div>
                        <span class="font-medium text-gray-500">Pembayaran</span>
                    </div>
                </div>

                <!-- Checkout Form -->
                <form id="checkout-form">
                    <!-- Step 1: Customer Information -->
                    <div id="step-1" class="checkout-step-content">
                        <h4 class="text-lg font-semibold mb-4">Informasi Pelanggan</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-gray-700 text-sm font-medium mb-2">Nama Lengkap</label>
                                <input type="text" id="customer-name" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-medium mb-2">No. Telepon</label>
                                <input type="tel" id="customer-phone" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500" required>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Alamat Lengkap</label>
                                <textarea id="customer-address" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500" rows="3" required></textarea>
                            </div>
                            <div class="md:col-span-2">
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" id="create-account" class="rounded">
                                    <label for="create-account" class="text-sm text-gray-700">Buat akun untuk pembelian berikutnya</label>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between">
                            <button type="button" id="next-to-location" class="gradient-bg text-white py-2 px-6 rounded-lg font-semibold hover:opacity-90 transition-opacity">
                                Lanjut ke Lokasi
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Location Information -->
                    <div id="step-2" class="checkout-step-content hidden">
                        <h4 class="text-lg font-semibold mb-4">Pilih Lokasi Pengiriman</h4>
                        <div class="mb-4">
                            <button type="button" id="use-current-location" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                <i class="fas fa-location-arrow mr-2"></i>Gunakan Lokasi Saat Ini
                            </button>
                        </div>
                        
                        <div class="map-container mb-4">
                            <div id="map"></div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h5 class="font-semibold mb-2">Informasi Lokasi:</h5>
                            <div class="text-sm text-gray-600">
                                <p>Geser pin merah untuk menentukan lokasi pengiriman yang tepat</p>
                                <p class="mt-1" id="location-info">Lokasi belum dipilih</p>
                            </div>
                        </div>
                        
                        <div class="flex justify-between mt-6">
                            <button type="button" id="back-to-info" class="border border-gray-300 text-gray-700 py-2 px-6 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
                                Kembali
                            </button>
                            <button type="button" id="next-to-payment" class="gradient-bg text-white py-2 px-6 rounded-lg font-semibold hover:opacity-90 transition-opacity">
                                Lanjut ke Pembayaran
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Payment -->
                    <div id="step-3" class="checkout-step-content hidden">
                        <h4 class="text-lg font-semibold mb-4">Ringkasan Pembayaran</h4>
                        
                        <!-- Shipping Information -->
                        <div class="shipping-info mb-6">
                            <h5 class="font-semibold mb-3">Informasi Pengiriman</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">Kurir</p>
                                    <p class="font-semibold">VLCrave Express</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Estimasi</p>
                                    <p class="font-semibold">30-45 menit</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Jarak</p>
                                    <p class="font-semibold" id="shipping-distance">- km</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Ongkir</p>
                                    <p class="font-semibold" id="shipping-cost">Rp 0</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Order Summary -->
                        <div class="border rounded-lg p-4 mb-6">
                            <h5 class="font-semibold mb-3">Ringkasan Pesanan</h5>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span>Subtotal Produk</span>
                                    <span id="order-subtotal">Rp 0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Biaya Pengiriman</span>
                                    <span id="order-shipping">Rp 0</span>
                                </div>
                                <div class="flex justify-between border-t pt-2">
                                    <span class="font-semibold">Total Pembayaran</span>
                                    <span class="font-semibold text-orange-500" id="order-total">Rp 0</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payment Methods -->
                        <div class="mb-6">
                            <h5 class="font-semibold mb-3">Metode Pembayaran</h5>
                            <div class="space-y-3">
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center space-x-3">
                                        <input type="radio" name="payment" id="cod" class="text-orange-500" checked>
                                        <label for="cod" class="font-medium">Cash on Delivery (COD)</label>
                                    </div>
                                    <p class="text-sm text-gray-600 mt-2 ml-6">Bayar ketika pesanan sampai</p>
                                </div>
                                
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center space-x-3">
                                        <input type="radio" name="payment" id="transfer" class="text-orange-500">
                                        <label for="transfer" class="font-medium">Transfer Bank</label>
                                    </div>
                                    <div class="mt-2 ml-6 grid grid-cols-2 gap-2" id="bank-accounts">
                                        <!-- Bank accounts will be loaded from Firebase -->
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center space-x-3">
                                        <input type="radio" name="payment" id="qris" class="text-orange-500">
                                        <label for="qris" class="font-medium">QRIS</label>
                                    </div>
                                    <div class="mt-2 ml-6">
                                        <div class="border rounded p-3 text-center max-w-xs">
                                            <div id="qris-code" class="text-center">
                                                <!-- QRIS code will be loaded here -->
                                                <div class="bg-gray-200 h-32 w-32 mx-auto flex items-center justify-center">
                                                    <span class="text-gray-500">QR Code</span>
                                                </div>
                                            </div>
                                            <p class="text-xs text-gray-600 mt-2">Scan QR code untuk pembayaran</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between">
                            <button type="button" id="back-to-location" class="border border-gray-300 text-gray-700 py-2 px-6 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
                                Kembali
                            </button>
                            <button type="submit" class="gradient-bg text-white py-2 px-6 rounded-lg font-semibold hover:opacity-90 transition-opacity">
                                Bayar Sekarang
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const promoPopup = document.getElementById('promo-popup');
        const closePopupBtn = document.getElementById('close-popup');
        const cartBtn = document.getElementById('cart-btn');
        const cartModal = document.getElementById('cart-modal');
        const closeCartBtn = document.getElementById('close-cart');
        const checkoutBtn = document.getElementById('checkout-btn');
        const checkoutModal = document.getElementById('checkout-modal');
        const closeCheckoutBtn = document.getElementById('close-checkout');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const nextToLocationBtn = document.getElementById('next-to-location');
        const backToInfoBtn = document.getElementById('back-to-info');
        const nextToPaymentBtn = document.getElementById('next-to-payment');
        const backToLocationBtn = document.getElementById('back-to-location');
        const useCurrentLocationBtn = document.getElementById('use-current-location');
        const checkoutForm = document.getElementById('checkout-form');
        const checkoutSteps = document.querySelectorAll('.checkout-step');
        const checkoutStepContents = document.querySelectorAll('.checkout-step-content');

        // Cart data
        let cart = [];
        let cartCount = document.getElementById('cart-count');
        let cartItems = document.getElementById('cart-items');
        let cartTotal = document.getElementById('cart-total');

        // Map variables
        let map;
        let userMarker;
        let storeLocation = { lat: -2.1234, lng: 106.1234 }; // Titik pusat: 9Q5C+PG7 Kuto Panji

        // Shipping calculation variables
        let shippingDistance = 0;
        let shippingCost = 0;

        // Event Listeners
        closePopupBtn.addEventListener('click', () => {
            promoPopup.classList.add('hidden');
        });

        cartBtn.addEventListener('click', () => {
            cartModal.classList.remove('hidden');
            updateCartDisplay();
        });

        closeCartBtn.addEventListener('click', () => {
            cartModal.classList.add('hidden');
        });

        checkoutBtn.addEventListener('click', () => {
            if (cart.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Keranjang Kosong',
                    text: 'Tambahkan produk ke keranjang terlebih dahulu',
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }
            cartModal.classList.add('hidden');
            checkoutModal.classList.remove('hidden');
            setCheckoutStep(1);
            initializeMap();
        });

        closeCheckoutBtn.addEventListener('click', () => {
            checkoutModal.classList.add('hidden');
        });

        // Tab functionality
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // Remove active class from all buttons
                tabButtons.forEach(btn => {
                    btn.classList.remove('tab-active');
                });
                
                // Add active class to clicked button
                button.classList.add('tab-active');
                
                // Hide all tab contents
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Show selected tab content
                document.getElementById(`${tabId}-tab`).classList.remove('hidden');
                
                // Load products for the tab
                loadProducts(tabId);
            });
        });

        // Checkout steps navigation
        nextToLocationBtn.addEventListener('click', () => {
            // Validate step 1
            const name = document.getElementById('customer-name').value;
            const phone = document.getElementById('customer-phone').value;
            const address = document.getElementById('customer-address').value;
            
            if (!name || !phone || !address) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Data Belum Lengkap',
                    text: 'Harap isi semua informasi pelanggan',
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }
            
            setCheckoutStep(2);
        });

        backToInfoBtn.addEventListener('click', () => {
            setCheckoutStep(1);
        });

        nextToPaymentBtn.addEventListener('click', () => {
            // Validate location
            if (!userMarker) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Lokasi Belum Dipilih',
                    text: 'Harap pilih lokasi pengiriman terlebih dahulu',
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }
            
            // Calculate shipping cost
            calculateShippingCost();
            updateOrderSummary();
            
            setCheckoutStep(3);
        });

        backToLocationBtn.addEventListener('click', () => {
            setCheckoutStep(2);
        });

        useCurrentLocationBtn.addEventListener('click', () => {
            getCurrentLocation();
        });

        checkoutForm.addEventListener('submit', (e) => {
            e.preventDefault();
            processOrder();
        });

        loginBtn.addEventListener('click', (e) => {
            e.preventDefault();
            Swal.fire({
                title: 'Masuk ke VLStore',
                html: `
                    <input type="email" id="login-email" class="swal2-input" placeholder="Email">
                    <input type="password" id="login-password" class="swal2-input" placeholder="Password">
                `,
                confirmButtonText: 'Masuk',
                showCancelButton: true,
                cancelButtonText: 'Batal',
                preConfirm: () => {
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;
                    if (!email || !password) {
                        Swal.showValidationMessage('Harap isi semua field');
                    }
                    return { email, password };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // In a real app, you would authenticate here
                    Swal.fire({
                        icon: 'success',
                        title: 'Berhasil Masuk!',
                        text: 'Selamat datang kembali di VLStore',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
            });
        });

        registerBtn.addEventListener('click', (e) => {
            e.preventDefault();
            Swal.fire({
                title: 'Daftar Akun Baru',
                html: `
                    <input type="text" id="register-name" class="swal2-input" placeholder="Nama Lengkap">
                    <input type="email" id="register-email" class="swal2-input" placeholder="Email">
                    <input type="password" id="register-password" class="swal2-input" placeholder="Password">
                    <div class="text-left text-sm text-gray-600 mt-2">
                        <p class="font-semibold">Keuntungan menjadi member:</p>
                        <ul class="list-disc list-inside mt-1">
                            <li>Diskon khusus member</li>
                            <li>Poin reward setiap pembelian</li>
                            <li>Akses ke produk eksklusif</li>
                            <li>Notifikasi promo terbaru</li>
                        </ul>
                    </div>
                `,
                confirmButtonText: 'Daftar',
                showCancelButton: true,
                cancelButtonText: 'Batal',
                preConfirm: () => {
                    const name = document.getElementById('register-name').value;
                    const email = document.getElementById('register-email').value;
                    const password = document.getElementById('register-password').value;
                    if (!name || !email || !password) {
                        Swal.showValidationMessage('Harap isi semua field');
                    }
                    return { name, email, password };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // In a real app, you would register the user here
                    Swal.fire({
                        icon: 'success',
                        title: 'Pendaftaran Berhasil!',
                        text: 'Selamat! Akun Anda telah berhasil dibuat',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
            });
        });

        // Functions
        function setCheckoutStep(step) {
            // Update steps
            checkoutSteps.forEach((stepElement, index) => {
                if (index + 1 === step) {
                    stepElement.classList.add('active');
                    stepElement.classList.remove('border-gray-300');
                    stepElement.classList.add('border-orange-500');
                    stepElement.querySelector('div').classList.remove('bg-gray-300');
                    stepElement.querySelector('div').classList.add('bg-orange-500');
                    stepElement.querySelector('span').classList.remove('text-gray-500');
                } else {
                    stepElement.classList.remove('active');
                    stepElement.classList.add('border-gray-300');
                    stepElement.classList.remove('border-orange-500');
                    stepElement.querySelector('div').classList.add('bg-gray-300');
                    stepElement.querySelector('div').classList.remove('bg-orange-500');
                    stepElement.querySelector('span').classList.add('text-gray-500');
                }
            });
            
            // Update content
            checkoutStepContents.forEach((content, index) => {
                if (index + 1 === step) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
        }

        function initializeMap() {
            if (map) {
                map.remove();
            }
            
            // Initialize map with store location
            map = L.map('map').setView([storeLocation.lat, storeLocation.lng], 15);
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Add store marker
            L.marker([storeLocation.lat, storeLocation.lng])
                .addTo(map)
                .bindPopup('VLStore - Pusat')
                .openPopup();
            
            // Initialize user marker as draggable
            userMarker = L.marker([storeLocation.lat, storeLocation.lng], {
                draggable: true,
                icon: L.divIcon({
                    className: 'custom-marker',
                    html: '<i class="fas fa-map-marker-alt text-white"></i>',
                    iconSize: [30, 30],
                    iconAnchor: [15, 30]
                })
            }).addTo(map);
            
            // Update location when marker is dragged
            userMarker.on('dragend', function(event) {
                const marker = event.target;
                const position = marker.getLatLng();
                updateLocationInfo(position.lat, position.lng);
                calculateShippingCost();
            });
            
            // Update location when map is clicked
            map.on('click', function(event) {
                userMarker.setLatLng(event.latlng);
                updateLocationInfo(event.latlng.lat, event.latlng.lng);
                calculateShippingCost();
            });
            
            // Try to get current location
            getCurrentLocation();
        }

        function getCurrentLocation() {
            if (!navigator.geolocation) {
                Swal.fire({
                    icon: 'error',
                    title: 'Geolocation tidak didukung',
                    text: 'Browser Anda tidak mendukung geolocation',
                    timer: 2000,
                    showConfirmButton: false
                });
                return;
            }
            
            Swal.fire({
                title: 'Mendeteksi Lokasi...',
                text: 'Harap izinkan akses lokasi',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // Update user location
                    userMarker.setLatLng([lat, lng]);
                    map.setView([lat, lng], 15);
                    updateLocationInfo(lat, lng);
                    calculateShippingCost();
                    
                    Swal.close();
                    
                    // Update user location in header
                    document.getElementById('user-location').innerHTML = `
                        <i class="fas fa-map-marker-alt mr-1"></i>
                        <span>Lokasi: Terdeteksi</span>
                    `;
                },
                function(error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Gagal Mendeteksi Lokasi',
                        text: 'Tidak dapat mengakses lokasi Anda. Silakan pilih lokasi manual di peta.',
                        timer: 3000,
                        showConfirmButton: false
                    });
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        function updateLocationInfo(lat, lng) {
            // Simple location info without coordinates
            document.getElementById('location-info').textContent = 'Lokasi sudah dipilih. Geser pin merah untuk mengubah lokasi.';
        }

        function calculateShippingCost() {
            if (!userMarker) return;
            
            const userLatLng = userMarker.getLatLng();
            
            // Calculate distance using Haversine formula
            const R = 6371; // Earth's radius in km
            const dLat = (userLatLng.lat - storeLocation.lat) * Math.PI / 180;
            const dLon = (userLatLng.lng - storeLocation.lng) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(storeLocation.lat * Math.PI / 180) * Math.cos(userLatLng.lat * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            
            shippingDistance = distance;
            
            // Calculate shipping cost based on distance
            if (distance <= 2) {
                shippingCost = 5000; // 1-2km: Rp 5,000
            } else if (distance <= 4.5) {
                const additionalKm = distance - 2;
                shippingCost = 5000 + (additionalKm * 2000); // +Rp 2,000 per km
            } else {
                const additionalKm = distance - 4.5;
                shippingCost = 10000 + (additionalKm * 1000); // +Rp 1,000 per km after Rp 10,000
            }
            
            // Round to nearest thousand
            shippingCost = Math.ceil(shippingCost / 1000) * 1000;
            
            // Update UI
            document.getElementById('shipping-distance').textContent = `${distance.toFixed(1)} km`;
            document.getElementById('shipping-cost').textContent = `Rp ${formatPrice(shippingCost)}`;
        }

        function updateOrderSummary() {
            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            const total = subtotal + shippingCost;
            
            document.getElementById('order-subtotal').textContent = `Rp ${formatPrice(subtotal)}`;
            document.getElementById('order-shipping').textContent = `Rp ${formatPrice(shippingCost)}`;
            document.getElementById('order-total').textContent = `Rp ${formatPrice(total)}`;
        }

        function processOrder() {
            // Collect order data
            const orderData = {
                customer: {
                    name: document.getElementById('customer-name').value,
                    phone: document.getElementById('customer-phone').value,
                    address: document.getElementById('customer-address').value
                },
                location: {
                    lat: userMarker.getLatLng().lat,
                    lng: userMarker.getLatLng().lng
                },
                items: cart,
                shipping: {
                    distance: shippingDistance,
                    cost: shippingCost,
                    courier: 'VLCrave Express'
                },
                payment: {
                    method: document.querySelector('input[name="payment"]:checked').id,
                    total: cart.reduce((total, item) => total + (item.price * item.quantity), 0) + shippingCost
                },
                status: 'pending',
                createdAt: new Date(),
                orderNumber: `VL${Date.now()}`
            };
            
            Swal.fire({
                title: 'Memproses Pesanan...',
                text: 'Harap tunggu sebentar',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                    
                    // In a real app, you would save to Firebase here
                    setTimeout(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Pesanan Berhasil!',
                            html: `
                                <p>Terima kasih telah berbelanja di VLStore</p>
                                <p class="mt-2">No. Pesanan: <strong>${orderData.orderNumber}</strong></p>
                                <p class="text-sm mt-4">Pesanan Anda sedang diproses dan akan segera dikirim</p>
                            `,
                            confirmButtonText: 'OK'
                        }).then(() => {
                            checkoutModal.classList.add('hidden');
                            cart = [];
                            updateCartCount();
                        });
                    }, 2000);
                }
            });
        }

        function formatPrice(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function addToCart(product) {
            // Special handling for Alfamart/Indomaret
            if (product.type === 'alfamart' || product.type === 'indomaret') {
                showStoreOrderModal(product);
                return;
            }
            
            const existingItem = cart.find(item => item.id === product.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }
            
            updateCartCount();
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Produk telah ditambahkan ke keranjang',
                timer: 1500,
                showConfirmButton: false
            });
        }

        function showStoreOrderModal(product) {
            const storeName = product.type === 'alfamart' ? 'Alfamart' : 'Indomaret';
            const appName = product.type === 'alfamart' ? 'alfagift' : 'klikIndomaret';
            
            Swal.fire({
                title: `Pesan dari ${storeName}`,
                html: `
                    <div class="text-left">
                        <p class="mb-4">Untuk memesan produk ${storeName}, silakan:</p>
                        <ol class="list-decimal list-inside space-y-2 mb-4">
                            <li>Buka aplikasi <strong>${appName}</strong></li>
                            <li>Pilih produk yang diinginkan</li>
                            <li>Lakukan pembayaran</li>
                            <li>Upload bukti struk pembayaran</li>
                        </ol>
                        <p class="text-sm text-gray-600">Kami akan segera memproses pesanan Anda setelah menerima bukti pembayaran</p>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Upload Struk',
                cancelButtonText: 'Nanti',
                showDenyButton: true,
                denyButtonText: 'Buka Aplikasi',
                customClass: {
                    confirmButton: 'bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg',
                    denyButton: 'bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg',
                    cancelButton: 'bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg'
                },
                buttonsStyling: false
            }).then((result) => {
                if (result.isConfirmed) {
                    // Upload receipt
                    uploadReceipt(product);
                } else if (result.isDenied) {
                    // Open store app (simulated)
                    Swal.fire({
                        title: 'Membuka Aplikasi',
                        text: `Membuka ${appName}...`,
                        icon: 'info',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
            });
        }

        function uploadReceipt(product) {
            Swal.fire({
                title: 'Upload Struk Pembayaran',
                html: `
                    <input type="file" id="receipt-upload" accept="image/*" class="my-4">
                    <div class="text-sm text-gray-600">
                        <p>Pastikan struk jelas terbaca dan menunjukkan:</p>
                        <ul class="list-disc list-inside mt-2">
                            <li>Nama produk</li>
                            <li>Total pembayaran</li>
                            <li>Tanggal transaksi</li>
                        </ul>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Upload',
                cancelButtonText: 'Batal',
                preConfirm: () => {
                    const fileInput = document.getElementById('receipt-upload');
                    if (!fileInput.files[0]) {
                        Swal.showValidationMessage('Harap pilih file struk');
                        return false;
                    }
                    return fileInput.files[0];
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // Simulate upload process
                    Swal.fire({
                        title: 'Mengupload Struk...',
                        text: 'Harap tunggu sebentar',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                            
                            setTimeout(() => {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Struk Terupload!',
                                    html: `
                                        <p>Terima kasih telah mengupload struk pembayaran</p>
                                        <p class="text-sm mt-2">Pesanan Anda akan segera diproses setelah verifikasi</p>
                                    `,
                                    confirmButtonText: 'OK'
                                });
                            }, 2000);
                        }
                    });
                }
            });
        }

        function updateCartCount() {
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            cartCount.textContent = totalItems;
        }

        function updateCartDisplay() {
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-shopping-cart text-4xl mb-4"></i>
                        <p>Keranjang belanja Anda kosong</p>
                    </div>
                `;
                cartTotal.textContent = 'Rp 0';
                return;
            }
            
            let total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'flex items-center space-x-4 p-4 bg-gray-50 rounded-lg';
                cartItem.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded">
                    <div class="flex-1">
                        <h4 class="font-medium">${item.name}</h4>
                        <p class="text-red-500 font-bold">Rp ${formatPrice(item.price)}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="decrease-quantity text-gray-500 hover:text-red-500" data-id="${item.id}">
                            <i class="fas fa-minus"></i>
                        </button>
                        <span class="font-medium">${item.quantity}</span>
                        <button class="increase-quantity text-gray-500 hover:text-green-500" data-id="${item.id}">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="text-right">
                        <p class="font-bold">Rp ${formatPrice(itemTotal)}</p>
                        <button class="remove-item text-red-500 hover:text-red-700 text-sm" data-id="${item.id}">
                            Hapus
                        </button>
                    </div>
                `;
                
                cartItems.appendChild(cartItem);
            });
            
            cartTotal.textContent = `Rp ${formatPrice(total)}`;
            
            // Add event listeners to cart buttons
            document.querySelectorAll('.increase-quantity').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = e.target.closest('button').getAttribute('data-id');
                    const item = cart.find(item => item.id === productId);
                    if (item) {
                        item.quantity += 1;
                        updateCartDisplay();
                        updateCartCount();
                    }
                });
            });
            
            document.querySelectorAll('.decrease-quantity').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = e.target.closest('button').getAttribute('data-id');
                    const item = cart.find(item => item.id === productId);
                    if (item && item.quantity > 1) {
                        item.quantity -= 1;
                        updateCartDisplay();
                        updateCartCount();
                    }
                });
            });
            
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = e.target.getAttribute('data-id');
                    cart = cart.filter(item => item.id !== productId);
                    updateCartDisplay();
                    updateCartCount();
                });
            });
        }

        // Firebase Functions
        async function loadFomoProducts() {
            try {
                // Simulated FOMO products
                const fomoProducts = [
                    {
                        id: 101,
                        name: "Paket Hemat Makan Siang",
                        price: 35000,
                        originalPrice: 50000,
                        discount: 30,
                        rating: 4.7,
                        image: "https://via.placeholder.com/200x200",
                        type: "food",
                        category: "makanan",
                        fomo: true
                    },
                    {
                        id: 102,
                        name: "Minuman Segar Spesial",
                        price: 12000,
                        originalPrice: 18000,
                        discount: 33,
                        rating: 4.5,
                        image: "https://via.placeholder.com/200x200",
                        type: "drink",
                        category: "minuman",
                        fomo: true
                    },
                    {
                        id: 103,
                        name: "Pulsa 50.000",
                        price: 49000,
                        originalPrice: 52000,
                        discount: 6,
                        rating: 4.8,
                        image: "https://via.placeholder.com/200x200",
                        type: "digital",
                        category: "pulsa",
                        fomo: true
                    }
                ];
                
                const container = document.getElementById('fomo-products');
                container.innerHTML = '';
                
                fomoProducts.forEach(product => {
                    const productElement = createProductElement(product, true);
                    container.appendChild(productElement);
                });
            } catch (error) {
                console.error('Error loading FOMO products:', error);
            }
        }

        async function loadCategories() {
            try {
                // Simulated data
                const categories = [
                    { name: "Makanan", icon: "fas fa-utensils", color: "orange", id: "food" },
                    { name: "Minuman", icon: "fas fa-coffee", color: "blue", id: "drink" },
                    { name: "Populer", icon: "fas fa-fire", color: "red", id: "popular" },
                    { name: "Terdekat", icon: "fas fa-location-arrow", color: "green", id: "nearby" },
                    { name: "Alfamart", icon: "fas fa-shopping-bag", color: "blue", id: "alfamart" },
                    { name: "Indomaret", icon: "fas fa-store", color: "red", id: "indomaret" },
                    { name: "Pulsa", icon: "fas fa-mobile-alt", color: "purple", id: "pulsa" },
                    { name: "E-Wallet", icon: "fas fa-wallet", color: "green", id: "ewallet" }
                ];
                
                const container = document.getElementById('categories-list');
                const navContainer = document.getElementById('categories-nav');
                container.innerHTML = '';
                navContainer.innerHTML = '';
                
                categories.forEach(category => {
                    // Category cards
                    const categoryElement = document.createElement('div');
                    categoryElement.className = 'category-card bg-white rounded-lg shadow-sm p-4 text-center cursor-pointer';
                    categoryElement.setAttribute('data-category', category.id);
                    categoryElement.innerHTML = `
                        <div class="bg-${category.color}-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-2">
                            <i class="${category.icon} text-${category.color}-500 text-2xl"></i>
                        </div>
                        <span class="text-sm font-medium">${category.name}</span>
                    `;
                    container.appendChild(categoryElement);
                    
                    // Navigation items
                    const navElement = document.createElement('a');
                    navElement.href = '#';
                    navElement.className = 'text-gray-700 hover:text-orange-500 font-medium';
                    navElement.setAttribute('data-category', category.id);
                    navElement.textContent = category.name;
                    navContainer.appendChild(navElement);
                });
                
                // Add event listeners to category items
                document.querySelectorAll('[data-category]').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const category = e.currentTarget.getAttribute('data-category');
                        // Find and click the corresponding tab button
                        const tabButton = document.querySelector(`[data-tab="${category}"]`);
                        if (tabButton) {
                            tabButton.click();
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        async function loadProducts(type) {
            try {
                // Simulated data
                const products = {
                    all: [
                        {
                            id: 1,
                            name: "Nasi Goreng Spesial",
                            price: 25000,
                            originalPrice: 35000,
                            discount: 29,
                            rating: 4.5,
                            image: "https://via.placeholder.com/200x200",
                            type: "food",
                            category: "makanan"
                        },
                        {
                            id: 2,
                            name: "Es Teh Manis",
                            price: 8000,
                            originalPrice: 12000,
                            discount: 33,
                            rating: 4.2,
                            image: "https://via.placeholder.com/200x200",
                            type: "drink",
                            category: "minuman"
                        },
                        {
                            id: 3,
                            name: "Pulsa 10.000",
                            price: 11000,
                            originalPrice: 12000,
                            discount: 8,
                            rating: 4.8,
                            image: "https://via.placeholder.com/200x200",
                            type: "digital",
                            category: "pulsa"
                        },
                        {
                            id: 4,
                            name: "Gopay 20.000",
                            price: 20500,
                            originalPrice: 22000,
                            discount: 7,
                            rating: 4.7,
                            image: "https://via.placeholder.com/200x200",
                            type: "digital",
                            category: "ewallet"
                        },
                        {
                            id: 5,
                            name: "Ayam Geprek",
                            price: 18000,
                            originalPrice: 22000,
                            discount: 18,
                            rating: 4.6,
                            image: "https://via.placeholder.com/200x200",
                            type: "food",
                            category: "makanan"
                        },
                        {
                            id: 6,
                            name: "Snack Alfamart Pack",
                            price: 25000,
                            originalPrice: 30000,
                            discount: 17,
                            rating: 4.4,
                            image: "https://via.placeholder.com/200x200",
                            type: "alfamart",
                            category: "alfamart"
                        },
                        {
                            id: 7,
                            name: "Minuman Indomaret Bundle",
                            price: 15000,
                            originalPrice: 20000,
                            discount: 25,
                            rating: 4.3,
                            image: "https://via.placeholder.com/200x200",
                            type: "indomaret",
                            category: "indomaret"
                        }
                    ],
                    food: [],
                    drink: [],
                    digital: [],
                    popular: [],
                    nearby: [],
                    alfamart: [],
                    indomaret: []
                };

                // Filter products by type
                products.food = products.all.filter(product => product.type === "food");
                products.drink = products.all.filter(product => product.type === "drink");
                products.digital = products.all.filter(product => product.type === "digital");
                products.popular = products.all.slice(0, 4); // Top 4 as popular
                products.nearby = products.all.slice(2, 6); // Some as nearby
                products.alfamart = products.all.filter(product => product.type === "alfamart");
                products.indomaret = products.all.filter(product => product.type === "indomaret");
                
                const container = document.getElementById(`${type}-products`);
                container.innerHTML = '';
                
                products[type].forEach(product => {
                    const productElement = createProductElement(product, false);
                    container.appendChild(productElement);
                });
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        function createProductElement(product, isFomo = false) {
            const productElement = document.createElement('div');
            productElement.className = 'product-card bg-white rounded-lg shadow-md overflow-hidden';
            
            // Add store badge for Alfamart/Indomaret
            let storeBadge = '';
            if (product.type === 'alfamart' || product.type === 'indomaret') {
                const storeClass = product.type === 'alfamart' ? 'store-badge' : 'store-badge indomaret';
                const storeName = product.type === 'alfamart' ? 'Alfamart' : 'Indomaret';
                storeBadge = `<div class="${storeClass} text-white text-xs font-bold py-1 px-2 absolute top-2 right-2 rounded">${storeName}</div>`;
            }
            
            productElement.innerHTML = `
                <div class="relative">
                    <img src="${product.image}" alt="${product.name}" class="w-full h-40 object-cover">
                    ${product.discount ? `<div class="discount-badge text-white text-xs font-bold py-1 px-2 absolute top-2 left-2 rounded">-${product.discount}%</div>` : ''}
                    ${storeBadge}
                    ${isFomo ? `<div class="fomo-badge text-white text-xs font-bold py-1 px-2 absolute bottom-2 left-2 rounded">FOMO</div>` : ''}
                </div>
                <div class="p-3">
                    <h3 class="font-semibold text-sm mb-1 truncate">${product.name}</h3>
                    <div class="flex items-center space-x-1 mb-2">
                        <div class="flex text-yellow-400">
                            ${getStarRating(product.rating)}
                        </div>
                        <span class="text-xs text-gray-500">(${product.rating})</span>
                    </div>
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="text-red-500 font-bold">Rp ${formatPrice(product.price)}</span>
                        ${product.originalPrice ? `<span class="text-gray-500 text-sm line-through">Rp ${formatPrice(product.originalPrice)}</span>` : ''}
                    </div>
                    <button class="add-to-cart w-full bg-orange-500 hover:bg-orange-600 text-white py-2 rounded-lg transition-colors mt-2" data-id="${product.id}">
                        ${product.type === 'alfamart' || product.type === 'indomaret' ? 'Pesan Sekarang' : 'Tambah ke Keranjang'}
                    </button>
                </div>
            `;
            
            // Add event listener to "Add to Cart" button
            productElement.querySelector('.add-to-cart').addEventListener('click', () => {
                addToCart(product);
            });
            
            return productElement;
        }

        function getStarRating(rating) {
            let stars = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star"></i>';
            }
            
            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            }
            
            const emptyStars = 5 - Math.ceil(rating);
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star"></i>';
            }
            
            return stars;
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            // Load all data
            loadFomoProducts();
            loadCategories();
            loadProducts('all');
            
            // Set first tab as active
            tabButtons[0].classList.add('tab-active');
            
            // Show promo popup after 1 second
            setTimeout(() => {
                promoPopup.classList.remove('hidden');
            }, 1000);
        });
    </script>
</body>
</html>
