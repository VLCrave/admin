<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Management System</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar {
            transition: all 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
        }
        
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 40;
        }
        
        .sticky-sidebar {
            position: sticky;
            top: 80px;
            height: calc(100vh - 80px);
            overflow-y: auto;
        }
        
        .main-content {
            min-height: calc(100vh - 160px);
        }
        
        .footer {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        
        .tab-active {
            background-color: #4f46e5;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navbar -->
    <nav class="sticky-header bg-indigo-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <button id="menu-toggle" class="md:hidden text-white focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <h1 class="text-xl font-bold">Asset Management</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="add-transaction-btn" class="bg-indigo-700 hover:bg-indigo-800 px-4 py-2 rounded-lg transition-colors">
                    + Transaksi
                </button>
                <button id="add-asset-btn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors">
                    + Asset
                </button>
                <div class="relative">
                    <button id="user-menu" class="flex items-center space-x-2 focus:outline-none">
                        <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center">
                            <span>U</span>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar sticky-sidebar bg-white w-64 shadow-lg fixed md:relative z-30">
            <div class="p-4">
                <ul class="space-y-2 mt-4">
                    <li>
                        <a href="#dashboard" class="nav-item flex items-center space-x-3 p-3 rounded-lg bg-indigo-50 text-indigo-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#statistik" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            <span>Statistik</span>
                        </a>
                    </li>
                    <li>
                        <a href="#grafik" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <span>Grafik</span>
                        </a>
                    </li>
                    <li>
                        <a href="#analisis" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span>Analisis</span>
                        </a>
                    </li>
                    <li>
                        <a href="#transaksi" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                            <span>Transaksi</span>
                        </a>
                    </li>
                    <li>
                        <a href="#asset" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            <span>Asset</span>
                        </a>
                    </li>
                    <li>
                        <a href="#hutang-piutang" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>Hutang & Piutang</span>
                        </a>
                    </li>
                    <li>
                        <a href="#kategori" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                            <span>Kategori</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1">
            <div class="main-content p-4 md:p-6">
                <!-- Dashboard Section -->
                <div id="dashboard" class="content-section">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white rounded-xl shadow-md p-5 card-hover fade-in">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Total Asset</p>
                                    <h3 class="text-2xl font-bold" id="total-asset">Rp 0</h3>
                                </div>
                                <div class="bg-green-100 p-3 rounded-full">
                                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                    </svg>
                                </div>
                            </div>
                            <p class="text-green-600 text-sm mt-2" id="total-asset-change">+0% dari bulan lalu</p>
                        </div>

                        <div class="bg-white rounded-xl shadow-md p-5 card-hover fade-in">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Pemasukan</p>
                                    <h3 class="text-2xl font-bold" id="total-income">Rp 0</h3>
                                </div>
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                    </svg>
                                </div>
                            </div>
                            <p class="text-blue-600 text-sm mt-2" id="total-income-change">+0% dari bulan lalu</p>
                        </div>

                        <div class="bg-white rounded-xl shadow-md p-5 card-hover fade-in">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Pengeluaran</p>
                                    <h3 class="text-2xl font-bold" id="total-expense">Rp 0</h3>
                                </div>
                                <div class="bg-red-100 p-3 rounded-full">
                                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                    </svg>
                                </div>
                            </div>
                            <p class="text-red-600 text-sm mt-2" id="total-expense-change">+0% dari bulan lalu</p>
                        </div>

                        <div class="bg-white rounded-xl shadow-md p-5 card-hover fade-in">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Saldo Bersih</p>
                                    <h3 class="text-2xl font-bold" id="net-balance">Rp 0</h3>
                                </div>
                                <div class="bg-purple-100 p-3 rounded-full">
                                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                            </div>
                            <p class="text-purple-600 text-sm mt-2" id="net-balance-change">+0% dari bulan lalu</p>
                        </div>
                    </div>

                    <!-- Charts and Recent Data -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Chart Section -->
                        <div class="lg:col-span-2">
                            <div class="bg-white rounded-xl shadow-md p-5 card-hover fade-in">
                                <h3 class="text-lg font-semibold mb-4">Statistik Keuangan</h3>
                                <div class="h-80">
                                    <canvas id="finance-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Transactions -->
                        <div class="bg-white rounded-xl shadow-md p-5 card-hover fade-in">
                            <h3 class="text-lg font-semibold mb-4">Transaksi Terbaru</h3>
                            <div class="space-y-4" id="recent-transactions">
                                <!-- Transactions will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Recent Assets -->
                    <div class="mt-6 bg-white rounded-xl shadow-md p-5 card-hover fade-in">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Asset Terbaru</h3>
                            <a href="#asset" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">Lihat Semua</a>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-3 px-2">Nama Asset</th>
                                        <th class="text-left py-3 px-2">Kategori</th>
                                        <th class="text-left py-3 px-2">Nilai</th>
                                        <th class="text-left py-3 px-2">Tanggal</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-assets">
                                    <!-- Recent assets will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Statistik Section -->
                <div id="statistik" class="content-section hidden">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h2 class="text-2xl font-bold mb-6">Statistik Detail Keuangan</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl">
                                <h3 class="text-lg font-semibold mb-2">Pemasukan Bulan Ini</h3>
                                <p class="text-3xl font-bold" id="stat-income">Rp 0</p>
                                <p class="text-blue-100 mt-2" id="stat-income-change">+0% dari bulan lalu</p>
                            </div>
                            
                            <div class="bg-gradient-to-r from-red-500 to-red-600 text-white p-6 rounded-xl">
                                <h3 class="text-lg font-semibold mb-2">Pengeluaran Bulan Ini</h3>
                                <p class="text-3xl font-bold" id="stat-expense">Rp 0</p>
                                <p class="text-red-100 mt-2" id="stat-expense-change">+0% dari bulan lalu</p>
                            </div>
                            
                            <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl">
                                <h3 class="text-lg font-semibold mb-2">Saldo Bersih</h3>
                                <p class="text-3xl font-bold" id="stat-net">Rp 0</p>
                                <p class="text-green-100 mt-2" id="stat-net-change">+0% dari bulan lalu</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold mb-4">Distribusi Pengeluaran</h3>
                                <div class="h-64">
                                    <canvas id="expense-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold mb-4">Sumber Pemasukan</h3>
                                <div class="h-64">
                                    <canvas id="income-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Grafik Section -->
                <div id="grafik" class="content-section hidden">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h2 class="text-2xl font-bold mb-6">Grafik Analisis Keuangan</h2>
                        
                        <div class="mb-6">
                            <div class="flex space-x-2 border-b">
                                <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-600" data-tab="trend">Trend Keuangan</button>
                                <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-600" data-tab="comparison">Perbandingan</button>
                                <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-600" data-tab="forecast">Proyeksi</button>
                            </div>
                        </div>

                        <div id="trend-tab" class="tab-content">
                            <div class="h-96">
                                <canvas id="trend-chart"></canvas>
                            </div>
                        </div>
                        
                        <div id="comparison-tab" class="tab-content hidden">
                            <div class="h-96">
                                <canvas id="comparison-chart"></canvas>
                            </div>
                        </div>
                        
                        <div id="forecast-tab" class="tab-content hidden">
                            <div class="h-96">
                                <canvas id="forecast-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analisis Section -->
                <div id="analisis" class="content-section hidden">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h2 class="text-2xl font-bold mb-6">Analisis Keuangan Mendalam</h2>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-yellow-50 p-6 rounded-xl border border-yellow-200">
                                <h3 class="text-lg font-semibold mb-3 text-yellow-800">Analisis Cash Flow</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-yellow-700">Rasio Pemasukan/Pengeluaran:</span>
                                        <span class="font-semibold text-yellow-800" id="cash-ratio">0%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-yellow-700">Hari Cash Flow Positif:</span>
                                        <span class="font-semibold text-yellow-800" id="cash-days">0 hari</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-yellow-700">Trend Bulanan:</span>
                                        <span class="font-semibold text-yellow-800" id="cash-trend">Stabil</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 p-6 rounded-xl border border-green-200">
                                <h3 class="text-lg font-semibold mb-3 text-green-800">Kesehatan Keuangan</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-green-700">Skor Kesehatan:</span>
                                        <span class="font-semibold text-green-800" id="health-score">0/100</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-green-700">Rekomendasi:</span>
                                        <span class="font-semibold text-green-800" id="health-recommendation">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-green-700">Status:</span>
                                        <span class="font-semibold text-green-800" id="health-status">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                            <h3 class="text-lg font-semibold mb-4 text-blue-800">Insight & Rekomendasi</h3>
                            <div class="space-y-4" id="financial-insights">
                                <div class="flex items-start space-x-3">
                                    <div class="bg-blue-100 p-2 rounded-full mt-1">
                                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-blue-800 font-medium">Analisis pengeluaran menunjukkan pola yang sehat</p>
                                        <p class="text-blue-700 text-sm mt-1">Pertahankan konsistensi dalam pengelolaan keuangan</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transaksi Section -->
                <div id="transaksi" class="content-section hidden">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Manajemen Transaksi</h2>
                            <div class="flex space-x-3">
                                <select id="transaction-type-filter" class="border rounded-lg px-3 py-2 text-sm">
                                    <option value="all">Semua Jenis</option>
                                    <option value="pemasukan">Pemasukan</option>
                                    <option value="pengeluaran">Pengeluaran</option>
                                </select>
                                <select id="transaction-category-filter" class="border rounded-lg px-3 py-2 text-sm">
                                    <option value="all">Semua Kategori</option>
                                    <option value="kas pribadi">Kas Pribadi</option>
                                    <option value="usaha">Usaha</option>
                                </select>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-3 px-2">Deskripsi</th>
                                        <th class="text-left py-3 px-2">Kategori</th>
                                        <th class="text-left py-3 px-2">Jenis</th>
                                        <th class="text-left py-3 px-2">Jumlah</th>
                                        <th class="text-left py-3 px-2">Tanggal</th>
                                        <th class="text-left py-3 px-2">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="transactions-table">
                                    <!-- Transactions will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Asset Section -->
                <div id="asset" class="content-section hidden">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Manajemen Asset</h2>
                            <div class="flex space-x-3">
                                <select id="asset-category-filter" class="border rounded-lg px-3 py-2 text-sm">
                                    <option value="all">Semua Kategori</option>
                                    <option value="kas pribadi">Kas Pribadi</option>
                                    <option value="usaha">Usaha</option>
                                    <option value="asset">Asset</option>
                                </select>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-3 px-2">Nama Asset</th>
                                        <th class="text-left py-3 px-2">Kategori</th>
                                        <th class="text-left py-3 px-2">Nilai</th>
                                        <th class="text-left py-3 px-2">Tanggal</th>
                                        <th class="text-left py-3 px-2">Status</th>
                                        <th class="text-left py-3 px-2">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="assets-table">
                                    <!-- Assets will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Hutang & Piutang Section -->
                <div id="hutang-piutang" class="content-section hidden">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h2 class="text-2xl font-bold mb-6">Manajemen Hutang & Piutang</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="bg-orange-50 p-6 rounded-xl border border-orange-200">
                                <h3 class="text-lg font-semibold mb-4 text-orange-800">Hutang</h3>
                                <div class="space-y-4" id="debt-list">
                                    <!-- Debt items will be loaded here -->
                                </div>
                            </div>
                            
                            <div class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                                <h3 class="text-lg font-semibold mb-4 text-blue-800">Piutang</h3>
                                <div class="space-y-4" id="receivable-list">
                                    <!-- Receivable items will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Kategori Section -->
                <div id="kategori" class="content-section hidden">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h2 class="text-2xl font-bold mb-6">Manajemen Kategori</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-indigo-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold mb-4 text-indigo-800">Kategori Transaksi</h3>
                                <div class="space-y-3" id="transaction-categories">
                                    <!-- Transaction categories will be loaded here -->
                                </div>
                            </div>
                            
                            <div class="bg-green-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold mb-4 text-green-800">Kategori Asset</h3>
                                <div class="space-y-3" id="asset-categories">
                                    <!-- Asset categories will be loaded here -->
                                </div>
                            </div>
                            
                            <div class="bg-purple-50 p-6 rounded-xl">
                                <h3 class="text-lg font-semibold mb-4 text-purple-800">Tambah Kategori Baru</h3>
                                <form id="category-form" class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Kategori</label>
                                        <input type="text" id="category-name" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Jenis</label>
                                        <select id="category-type" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                                            <option value="">Pilih Jenis</option>
                                            <option value="transaction">Transaksi</option>
                                            <option value="asset">Asset</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition-colors">Tambah Kategori</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="col-span-1 md:col-span-2">
                    <h3 class="text-xl font-bold mb-4">Asset Management System</h3>
                    <p class="text-indigo-100 mb-4">
                        Solusi lengkap untuk mengelola aset keuangan Anda dengan mudah dan efisien. 
                        Pantau pemasukan, pengeluaran, hutang, dan piutang dalam satu platform.
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-indigo-100 hover:text-white transition-colors">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-indigo-100 hover:text-white transition-colors">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-indigo-100 hover:text-white transition-colors">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.042-3.441.219-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001.012.001z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Fitur</h4>
                    <ul class="space-y-2 text-indigo-100">
                        <li><a href="#dashboard" class="hover:text-white transition-colors">Dashboard</a></li>
                        <li><a href="#statistik" class="hover:text-white transition-colors">Statistik</a></li>
                        <li><a href="#grafik" class="hover:text-white transition-colors">Grafik</a></li>
                        <li><a href="#analisis" class="hover:text-white transition-colors">Analisis</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Support</h4>
                    <ul class="space-y-2 text-indigo-100">
                        <li><a href="#" class="hover:text-white transition-colors">Bantuan</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Kontak</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Privacy Policy</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-indigo-400 mt-8 pt-6 text-center text-indigo-200">
                <p>&copy; 2024 Asset Management System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Add Transaction Modal -->
    <div id="add-transaction-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-4 animate__animated animate__fadeInUp">
            <div class="p-6">
                <h3 class="text-xl font-semibold mb-4">Tambah Transaksi Baru</h3>
                <form id="transaction-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Deskripsi</label>
                        <input type="text" id="transaction-description" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Kategori</label>
                        <select id="transaction-category" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                            <option value="">Pilih Kategori</option>
                            <option value="kas pribadi">Kas Pribadi</option>
                            <option value="usaha">Usaha</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Jenis</label>
                        <select id="transaction-type" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                            <option value="">Pilih Jenis</option>
                            <option value="pemasukan">Pemasukan</option>
                            <option value="pengeluaran">Pengeluaran</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Jumlah (Rp)</label>
                        <input type="number" id="transaction-amount" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Tanggal</label>
                        <input type="date" id="transaction-date" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-transaction" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Batal</button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Simpan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Asset Modal -->
    <div id="add-asset-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-4 animate__animated animate__fadeInUp">
            <div class="p-6">
                <h3 class="text-xl font-semibold mb-4">Tambah Asset Baru</h3>
                <form id="asset-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Nama Asset</label>
                        <input type="text" id="asset-name" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Kategori</label>
                        <select id="asset-category" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                            <option value="">Pilih Kategori</option>
                            <option value="kas pribadi">Kas Pribadi</option>
                            <option value="usaha">Usaha</option>
                            <option value="asset">Asset</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Nilai (Rp)</label>
                        <input type="number" id="asset-value" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Tanggal</label>
                        <input type="date" id="asset-date" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Deskripsi</label>
                        <textarea id="asset-description" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-asset" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Batal</button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Simpan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDqigW41nufIzMOtxHjcAN7ZRLFNokHDS0",
            authDomain: "vlonline.firebaseapp.com",
            projectId: "vlonline",
            storageBucket: "vlonline.firebasestorage.app",
            messagingSenderId: "860419602853",
            appId: "1:860419602853:web:9f68d7ca09305293ab104c",
            measurementId: "G-0QVS1K2BHL"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // DOM Elements
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const addTransactionBtn = document.getElementById('add-transaction-btn');
        const addAssetBtn = document.getElementById('add-asset-btn');
        const addTransactionModal = document.getElementById('add-transaction-modal');
        const addAssetModal = document.getElementById('add-asset-modal');
        const cancelTransactionBtn = document.getElementById('cancel-transaction');
        const cancelAssetBtn = document.getElementById('cancel-asset');
        const transactionForm = document.getElementById('transaction-form');
        const assetForm = document.getElementById('asset-form');
        const categoryForm = document.getElementById('category-form');
        const transactionsTable = document.getElementById('transactions-table');
        const assetsTable = document.getElementById('assets-table');
        const recentTransactions = document.getElementById('recent-transactions');
        const recentAssets = document.getElementById('recent-assets');
        const transactionTypeFilter = document.getElementById('transaction-type-filter');
        const transactionCategoryFilter = document.getElementById('transaction-category-filter');
        const assetCategoryFilter = document.getElementById('asset-category-filter');
        const navItems = document.querySelectorAll('.nav-item');
        const contentSections = document.querySelectorAll('.content-section');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Stats elements
        const totalAssetEl = document.getElementById('total-asset');
        const totalIncomeEl = document.getElementById('total-income');
        const totalExpenseEl = document.getElementById('total-expense');
        const netBalanceEl = document.getElementById('net-balance');
        
        // Change percentage elements
        const totalAssetChangeEl = document.getElementById('total-asset-change');
        const totalIncomeChangeEl = document.getElementById('total-income-change');
        const totalExpenseChangeEl = document.getElementById('total-expense-change');
        const netBalanceChangeEl = document.getElementById('net-balance-change');

        // Chart variables
        let financeChart, expenseChart, incomeChart, trendChart, comparisonChart, forecastChart;

        // Data storage for calculations
        let currentMonthData = {
            income: 0,
            expense: 0,
            asset: 0,
            netBalance: 0
        };
        
        let previousMonthData = {
            income: 0,
            expense: 0,
            asset: 0,
            netBalance: 0
        };

        // Toggle sidebar on mobile
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });

        // Show add transaction modal
        addTransactionBtn.addEventListener('click', () => {
            addTransactionModal.classList.remove('hidden');
            document.getElementById('transaction-form').reset();
        });

        // Show add asset modal
        addAssetBtn.addEventListener('click', () => {
            addAssetModal.classList.remove('hidden');
            document.getElementById('asset-form').reset();
        });

        // Hide modals
        cancelTransactionBtn.addEventListener('click', () => {
            addTransactionModal.classList.add('hidden');
        });

        cancelAssetBtn.addEventListener('click', () => {
            addAssetModal.classList.add('hidden');
        });

        // Close modals when clicking outside
        addTransactionModal.addEventListener('click', (e) => {
            if (e.target === addTransactionModal) {
                addTransactionModal.classList.add('hidden');
            }
        });

        addAssetModal.addEventListener('click', (e) => {
            if (e.target === addAssetModal) {
                addAssetModal.classList.add('hidden');
            }
        });

        // Tab functionality
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // Remove active class from all buttons
                tabButtons.forEach(btn => {
                    btn.classList.remove('tab-active', 'text-indigo-600', 'border-indigo-600');
                    btn.classList.add('text-gray-600', 'border-transparent');
                });
                
                // Add active class to clicked button
                button.classList.add('tab-active', 'text-indigo-600', 'border-indigo-600');
                button.classList.remove('text-gray-600', 'border-transparent');
                
                // Hide all tab contents
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Show selected tab content
                document.getElementById(`${tabId}-tab`).classList.remove('hidden');
            });
        });

        // Navigation functionality
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Remove active class from all items
                navItems.forEach(nav => {
                    nav.classList.remove('bg-indigo-50', 'text-indigo-600');
                    nav.classList.add('hover:bg-gray-100');
                });
                
                // Add active class to clicked item
                item.classList.add('bg-indigo-50', 'text-indigo-600');
                item.classList.remove('hover:bg-gray-100');
                
                // Get target section
                const targetId = item.getAttribute('href').substring(1);
                
                // Hide all sections
                contentSections.forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Show target section
                document.getElementById(targetId).classList.remove('hidden');
                
                // Load specific data for the section
                if (targetId === 'transaksi') {
                    loadTransactions();
                } else if (targetId === 'asset') {
                    loadAssets();
                } else if (targetId === 'hutang-piutang') {
                    loadDebtAndReceivable();
                } else if (targetId === 'kategori') {
                    loadCategories();
                } else if (targetId === 'statistik') {
                    updateStatisticCharts();
                } else if (targetId === 'grafik') {
                    updateGraphCharts();
                } else if (targetId === 'analisis') {
                    updateAnalysisData();
                }
                
                // Close sidebar on mobile after selection
                if (window.innerWidth < 768) {
                    sidebar.classList.remove('active');
                }
            });
        });

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Format date
        function formatDate(dateString) {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }

        // Get type color
        function getTypeColor(type) {
            switch(type) {
                case 'pemasukan': return 'text-green-600';
                case 'pengeluaran': return 'text-red-600';
                case 'hutang': return 'text-orange-600';
                case 'piutang': return 'text-blue-600';
                default: return 'text-gray-600';
            }
        }

        // Get type icon
        function getTypeIcon(type) {
            switch(type) {
                case 'pemasukan': 
                    return `<svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                    </svg>`;
                case 'pengeluaran':
                    return `<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>`;
                case 'hutang':
                    return `<svg class="w-5 h-5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>`;
                case 'piutang':
                    return `<svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>`;
                default:
                    return `<svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>`;
            }
        }

        // Calculate percentage change
        function calculatePercentageChange(current, previous) {
            if (previous === 0) {
                return current > 0 ? 100 : 0;
            }
            return ((current - previous) / previous) * 100;
        }

        // Format percentage
        function formatPercentage(percentage) {
            const sign = percentage >= 0 ? '+' : '';
            return `${sign}${percentage.toFixed(1)}%`;
        }

        // Save transaction to Firebase
        transactionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const description = document.getElementById('transaction-description').value;
            const category = document.getElementById('transaction-category').value;
            const type = document.getElementById('transaction-type').value;
            const amount = parseInt(document.getElementById('transaction-amount').value);
            const date = document.getElementById('transaction-date').value;
            
            try {
                await db.collection('transactions').add({
                    description: description,
                    category: category,
                    type: type,
                    amount: amount,
                    date: date,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                Swal.fire({
                    icon: 'success',
                    title: 'Berhasil!',
                    text: 'Transaksi berhasil ditambahkan',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                addTransactionModal.classList.add('hidden');
                loadTransactions();
                updateStats();
                updateChart();
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error!',
                    text: 'Gagal menambahkan transaksi: ' + error.message
                });
            }
        });

        // Save asset to Firebase
        assetForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('asset-name').value;
            const category = document.getElementById('asset-category').value;
            const value = parseInt(document.getElementById('asset-value').value);
            const date = document.getElementById('asset-date').value;
            const description = document.getElementById('asset-description').value;
            
            try {
                await db.collection('assets').add({
                    name: name,
                    category: category,
                    value: value,
                    date: date,
                    description: description,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                Swal.fire({
                    icon: 'success',
                    title: 'Berhasil!',
                    text: 'Asset berhasil ditambahkan',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                addAssetModal.classList.add('hidden');
                loadAssets();
                updateStats();
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error!',
                    text: 'Gagal menambahkan asset: ' + error.message
                });
            }
        });

        // Save category to Firebase
        categoryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('category-name').value;
            const type = document.getElementById('category-type').value;
            
            try {
                await db.collection('categories').add({
                    name: name,
                    type: type,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                Swal.fire({
                    icon: 'success',
                    title: 'Berhasil!',
                    text: 'Kategori berhasil ditambahkan',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                categoryForm.reset();
                loadCategories();
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error!',
                    text: 'Gagal menambahkan kategori: ' + error.message
                });
            }
        });

        // Load transactions from Firebase
        async function loadTransactions() {
            try {
                const snapshot = await db.collection('transactions')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                transactionsTable.innerHTML = '';
                
                if (snapshot.empty) {
                    transactionsTable.innerHTML = `
                        <tr>
                            <td colspan="6" class="py-4 text-center text-gray-500">
                                Belum ada data transaksi
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(doc => {
                    const transaction = doc.data();
                    const transactionId = doc.id;
                    
                    // Apply filters
                    const selectedType = transactionTypeFilter.value;
                    const selectedCategory = transactionCategoryFilter.value;
                    
                    if (selectedType !== 'all' && transaction.type !== selectedType) {
                        return;
                    }
                    
                    if (selectedCategory !== 'all' && transaction.category !== selectedCategory) {
                        return;
                    }
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="py-3 px-2">${transaction.description}</td>
                        <td class="py-3 px-2">
                            <span class="bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded-full">
                                ${transaction.category}
                            </span>
                        </td>
                        <td class="py-3 px-2">
                            <span class="text-xs px-2 py-1 rounded-full ${transaction.type === 'pemasukan' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${transaction.type}
                            </span>
                        </td>
                        <td class="py-3 px-2 ${getTypeColor(transaction.type)} font-medium">
                            ${formatCurrency(transaction.amount)}
                        </td>
                        <td class="py-3 px-2">${formatDate(transaction.date)}</td>
                        <td class="py-3 px-2">
                            <button class="text-red-500 hover:text-red-700 delete-transaction" data-id="${transactionId}">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </td>
                    `;
                    
                    transactionsTable.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-transaction').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const transactionId = e.currentTarget.getAttribute('data-id');
                        deleteTransaction(transactionId);
                    });
                });
                
            } catch (error) {
                console.error('Error loading transactions:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error!',
                    text: 'Gagal memuat data transaksi'
                });
            }
        }

        // Load assets from Firebase
        async function loadAssets() {
            try {
                const snapshot = await db.collection('assets')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                assetsTable.innerHTML = '';
                
                if (snapshot.empty) {
                    assetsTable.innerHTML = `
                        <tr>
                            <td colspan="6" class="py-4 text-center text-gray-500">
                                Belum ada data asset
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(doc => {
                    const asset = doc.data();
                    const assetId = doc.id;
                    
                    // Apply category filter
                    const selectedCategory = assetCategoryFilter.value;
                    if (selectedCategory !== 'all' && asset.category !== selectedCategory) {
                        return;
                    }
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="py-3 px-2">${asset.name}</td>
                        <td class="py-3 px-2">
                            <span class="bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded-full">
                                ${asset.category}
                            </span>
                        </td>
                        <td class="py-3 px-2 font-medium text-green-600">
                            ${formatCurrency(asset.value)}
                        </td>
                        <td class="py-3 px-2">${formatDate(asset.date)}</td>
                        <td class="py-3 px-2">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">
                                Aktif
                            </span>
                        </td>
                        <td class="py-3 px-2">
                            <button class="text-red-500 hover:text-red-700 delete-asset" data-id="${assetId}">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </td>
                    `;
                    
                    assetsTable.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-asset').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const assetId = e.currentTarget.getAttribute('data-id');
                        deleteAsset(assetId);
                    });
                });
                
            } catch (error) {
                console.error('Error loading assets:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error!',
                    text: 'Gagal memuat data asset'
                });
            }
        }

        // Load recent transactions for dashboard
        async function loadRecentTransactions() {
            try {
                const snapshot = await db.collection('transactions')
                    .orderBy('createdAt', 'desc')
                    .limit(5)
                    .get();
                
                recentTransactions.innerHTML = '';
                
                if (snapshot.empty) {
                    recentTransactions.innerHTML = `
                        <div class="text-center text-gray-500 py-4">
                            Belum ada transaksi
                        </div>
                    `;
                    return;
                }
                
                snapshot.forEach(doc => {
                    const transaction = doc.data();
                    const transactionItem = document.createElement('div');
                    transactionItem.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                    transactionItem.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="p-2 rounded-full bg-white">
                                ${getTypeIcon(transaction.type)}
                            </div>
                            <div>
                                <p class="font-medium">${transaction.description}</p>
                                <p class="text-xs text-gray-500">${formatDate(transaction.date)}</p>
                            </div>
                        </div>
                        <div class="${getTypeColor(transaction.type)} font-medium">
                            ${formatCurrency(transaction.amount)}
                        </div>
                    `;
                    
                    recentTransactions.appendChild(transactionItem);
                });
            } catch (error) {
                console.error('Error loading recent transactions:', error);
            }
        }

        // Load recent assets for dashboard
        async function loadRecentAssets() {
            try {
                const snapshot = await db.collection('assets')
                    .orderBy('createdAt', 'desc')
                    .limit(5)
                    .get();
                
                recentAssets.innerHTML = '';
                
                if (snapshot.empty) {
                    recentAssets.innerHTML = `
                        <tr>
                            <td colspan="4" class="py-4 text-center text-gray-500">
                                Belum ada asset
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(doc => {
                    const asset = doc.data();
                    const row = document.createElement('tr');
                    row.className = 'border-b hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="py-3 px-2">${asset.name}</td>
                        <td class="py-3 px-2">
                            <span class="bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded-full">
                                ${asset.category}
                            </span>
                        </td>
                        <td class="py-3 px-2 font-medium text-green-600">
                            ${formatCurrency(asset.value)}
                        </td>
                        <td class="py-3 px-2">${formatDate(asset.date)}</td>
                    `;
                    
                    recentAssets.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading recent assets:', error);
            }
        }

        // Load debt and receivable
        async function loadDebtAndReceivable() {
            try {
                const transactionsSnapshot = await db.collection('transactions')
                    .where('type', 'in', ['hutang', 'piutang'])
                    .get();
                
                const debtList = document.getElementById('debt-list');
                const receivableList = document.getElementById('receivable-list');
                
                debtList.innerHTML = '';
                receivableList.innerHTML = '';
                
                let hasDebt = false;
                let hasReceivable = false;
                
                transactionsSnapshot.forEach(doc => {
                    const transaction = doc.data();
                    
                    if (transaction.type === 'hutang') {
                        hasDebt = true;
                        const debtItem = document.createElement('div');
                        debtItem.className = 'bg-white p-4 rounded-lg border border-orange-200';
                        debtItem.innerHTML = `
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-semibold text-orange-800">${transaction.description}</h4>
                                <span class="text-orange-600 font-bold">${formatCurrency(transaction.amount)}</span>
                            </div>
                            <p class="text-orange-600 text-sm">Jatuh Tempo: ${formatDate(transaction.date)}</p>
                        `;
                        debtList.appendChild(debtItem);
                    } else if (transaction.type === 'piutang') {
                        hasReceivable = true;
                        const receivableItem = document.createElement('div');
                        receivableItem.className = 'bg-white p-4 rounded-lg border border-blue-200';
                        receivableItem.innerHTML = `
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-semibold text-blue-800">${transaction.description}</h4>
                                <span class="text-blue-600 font-bold">${formatCurrency(transaction.amount)}</span>
                            </div>
                            <p class="text-blue-600 text-sm">Jatuh Tempo: ${formatDate(transaction.date)}</p>
                        `;
                        receivableList.appendChild(receivableItem);
                    }
                });
                
                if (!hasDebt) {
                    debtList.innerHTML = '<p class="text-orange-600 text-center py-4">Tidak ada hutang</p>';
                }
                
                if (!hasReceivable) {
                    receivableList.innerHTML = '<p class="text-blue-600 text-center py-4">Tidak ada piutang</p>';
                }
                
            } catch (error) {
                console.error('Error loading debt and receivable:', error);
            }
        }

        // Load categories
        async function loadCategories() {
            try {
                const transactionCategories = document.getElementById('transaction-categories');
                const assetCategories = document.getElementById('asset-categories');
                
                // Default categories
                const defaultTransactionCategories = ['Kas Pribadi', 'Usaha'];
                const defaultAssetCategories = ['Kas Pribadi', 'Usaha', 'Asset'];
                
                transactionCategories.innerHTML = '';
                assetCategories.innerHTML = '';
                
                // Add default transaction categories
                defaultTransactionCategories.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'flex justify-between items-center bg-white p-3 rounded-lg border';
                    categoryItem.innerHTML = `
                        <span class="text-indigo-700">${category}</span>
                        <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full">Default</span>
                    `;
                    transactionCategories.appendChild(categoryItem);
                });
                
                // Add default asset categories
                defaultAssetCategories.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'flex justify-between items-center bg-white p-3 rounded-lg border';
                    categoryItem.innerHTML = `
                        <span class="text-green-700">${category}</span>
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Default</span>
                    `;
                    assetCategories.appendChild(categoryItem);
                });
                
                // Load custom categories from Firebase
                const snapshot = await db.collection('categories').get();
                
                snapshot.forEach(doc => {
                    const category = doc.data();
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'flex justify-between items-center bg-white p-3 rounded-lg border';
                    
                    if (category.type === 'transaction') {
                        categoryItem.innerHTML = `
                            <span class="text-indigo-700">${category.name}</span>
                            <button class="text-red-500 hover:text-red-700 delete-category" data-id="${doc.id}">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        `;
                        transactionCategories.appendChild(categoryItem);
                    } else {
                        categoryItem.innerHTML = `
                            <span class="text-green-700">${category.name}</span>
                            <button class="text-red-500 hover:text-red-700 delete-category" data-id="${doc.id}">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        `;
                        assetCategories.appendChild(categoryItem);
                    }
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-category').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const categoryId = e.currentTarget.getAttribute('data-id');
                        deleteCategory(categoryId);
                    });
                });
                
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        // Delete transaction
        async function deleteTransaction(transactionId) {
            const result = await Swal.fire({
                title: 'Hapus Transaksi?',
                text: "Anda tidak dapat mengembalikan data ini!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Hapus!',
                cancelButtonText: 'Batal'
            });
            
            if (result.isConfirmed) {
                try {
                    await db.collection('transactions').doc(transactionId).delete();
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Terhapus!',
                        text: 'Transaksi berhasil dihapus',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    loadTransactions();
                    updateStats();
                    updateChart();
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Gagal menghapus transaksi: ' + error.message
                    });
                }
            }
        }

        // Delete asset
        async function deleteAsset(assetId) {
            const result = await Swal.fire({
                title: 'Hapus Asset?',
                text: "Anda tidak dapat mengembalikan data ini!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Hapus!',
                cancelButtonText: 'Batal'
            });
            
            if (result.isConfirmed) {
                try {
                    await db.collection('assets').doc(assetId).delete();
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Terhapus!',
                        text: 'Asset berhasil dihapus',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    loadAssets();
                    updateStats();
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Gagal menghapus asset: ' + error.message
                    });
                }
            }
        }

        // Delete category
        async function deleteCategory(categoryId) {
            const result = await Swal.fire({
                title: 'Hapus Kategori?',
                text: "Kategori yang dihapus tidak dapat dikembalikan!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Hapus!',
                cancelButtonText: 'Batal'
            });
            
            if (result.isConfirmed) {
                try {
                    await db.collection('categories').doc(categoryId).delete();
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Terhapus!',
                        text: 'Kategori berhasil dihapus',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    loadCategories();
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Gagal menghapus kategori: ' + error.message
                    });
                }
            }
        }

        // Update stats
        async function updateStats() {
            try {
                const transactionsSnapshot = await db.collection('transactions').get();
                const assetsSnapshot = await db.collection('assets').get();
                
                // Reset data
                currentMonthData = {
                    income: 0,
                    expense: 0,
                    asset: 0,
                    netBalance: 0
                };
                
                previousMonthData = {
                    income: 0,
                    expense: 0,
                    asset: 0,
                    netBalance: 0
                };
                
                const currentDate = new Date();
                const currentMonth = currentDate.getMonth();
                const currentYear = currentDate.getFullYear();
                
                const previousMonth = currentMonth === 0 ? 11 : currentMonth - 1;
                const previousYear = currentMonth === 0 ? currentYear - 1 : currentYear;
                
                // Process transactions
                transactionsSnapshot.forEach(doc => {
                    const transaction = doc.data();
                    const amount = transaction.amount;
                    const transactionDate = new Date(transaction.date);
                    const transactionMonth = transactionDate.getMonth();
                    const transactionYear = transactionDate.getFullYear();
                    
                    // Check if transaction is from current month
                    if (transactionMonth === currentMonth && transactionYear === currentYear) {
                        if (transaction.type === 'pemasukan') {
                            currentMonthData.income += amount;
                        } else if (transaction.type === 'pengeluaran') {
                            currentMonthData.expense += amount;
                        }
                    }
                    
                    // Check if transaction is from previous month
                    if (transactionMonth === previousMonth && transactionYear === previousYear) {
                        if (transaction.type === 'pemasukan') {
                            previousMonthData.income += amount;
                        } else if (transaction.type === 'pengeluaran') {
                            previousMonthData.expense += amount;
                        }
                    }
                });
                
                // Process assets
                let totalAssetValue = 0;
                assetsSnapshot.forEach(doc => {
                    const asset = doc.data();
                    totalAssetValue += asset.value;
                });
                
                // Calculate net balances
                currentMonthData.netBalance = currentMonthData.income - currentMonthData.expense;
                previousMonthData.netBalance = previousMonthData.income - previousMonthData.expense;
                
                // Calculate total asset (income - expense + assets)
                const totalAsset = currentMonthData.income - currentMonthData.expense + totalAssetValue;
                const previousTotalAsset = previousMonthData.income - previousMonthData.expense + totalAssetValue;
                
                // Calculate percentage changes
                const assetChange = calculatePercentageChange(totalAsset, previousTotalAsset);
                const incomeChange = calculatePercentageChange(currentMonthData.income, previousMonthData.income);
                const expenseChange = calculatePercentageChange(currentMonthData.expense, previousMonthData.expense);
                const netBalanceChange = calculatePercentageChange(currentMonthData.netBalance, previousMonthData.netBalance);
                
                // Update UI
                totalAssetEl.textContent = formatCurrency(totalAsset);
                totalIncomeEl.textContent = formatCurrency(currentMonthData.income);
                totalExpenseEl.textContent = formatCurrency(currentMonthData.expense);
                netBalanceEl.textContent = formatCurrency(currentMonthData.netBalance);
                
                // Update percentage changes
                totalAssetChangeEl.textContent = `${formatPercentage(assetChange)} dari bulan lalu`;
                totalIncomeChangeEl.textContent = `${formatPercentage(incomeChange)} dari bulan lalu`;
                totalExpenseChangeEl.textContent = `${formatPercentage(expenseChange)} dari bulan lalu`;
                netBalanceChangeEl.textContent = `${formatPercentage(netBalanceChange)} dari bulan lalu`;
                
                // Update colors based on change
                totalAssetChangeEl.className = `text-sm mt-2 ${assetChange >= 0 ? 'text-green-600' : 'text-red-600'}`;
                totalIncomeChangeEl.className = `text-sm mt-2 ${incomeChange >= 0 ? 'text-blue-600' : 'text-red-600'}`;
                totalExpenseChangeEl.className = `text-sm mt-2 ${expenseChange >= 0 ? 'text-red-600' : 'text-green-600'}`;
                netBalanceChangeEl.className = `text-sm mt-2 ${netBalanceChange >= 0 ? 'text-purple-600' : 'text-red-600'}`;
                
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        // Update chart
        async function updateChart() {
            try {
                const snapshot = await db.collection('transactions').get();
                
                // Group by month
                const monthlyData = {};
                
                snapshot.forEach(doc => {
                    const transaction = doc.data();
                    const date = new Date(transaction.date);
                    const monthYear = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    
                    if (!monthlyData[monthYear]) {
                        monthlyData[monthYear] = {
                            income: 0,
                            expense: 0
                        };
                    }
                    
                    if (transaction.type === 'pemasukan') {
                        monthlyData[monthYear].income += transaction.amount;
                    } else if (transaction.type === 'pengeluaran') {
                        monthlyData[monthYear].expense += transaction.amount;
                    }
                });
                
                // Sort months
                const sortedMonths = Object.keys(monthlyData).sort();
                const last6Months = sortedMonths.slice(-6);
                
                const labels = last6Months.map(month => {
                    const [year, monthNum] = month.split('-');
                    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
                    return `${monthNames[parseInt(monthNum) - 1]} ${year}`;
                });
                
                const incomeData = last6Months.map(month => monthlyData[month]?.income || 0);
                const expenseData = last6Months.map(month => monthlyData[month]?.expense || 0);
                
                // Create or update chart
                const ctx = document.getElementById('finance-chart').getContext('2d');
                
                if (financeChart) {
                    financeChart.destroy();
                }
                
                financeChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Pemasukan',
                                data: incomeData,
                                backgroundColor: 'rgba(34, 197, 94, 0.7)',
                                borderColor: 'rgba(34, 197, 94, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Pengeluaran',
                                data: expenseData,
                                backgroundColor: 'rgba(239, 68, 68, 0.7)',
                                borderColor: 'rgba(239, 68, 68, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        if (value >= 1000000) {
                                            return 'Rp ' + (value / 1000000).toFixed(1) + 'Jt';
                                        } else if (value >= 1000) {
                                            return 'Rp ' + (value / 1000).toFixed(0) + 'Rb';
                                        }
                                        return 'Rp ' + value;
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += formatCurrency(context.parsed.y);
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error updating chart:', error);
            }
        }

        // Update statistic charts
        function updateStatisticCharts() {
            // Sample data for expense distribution
            const expenseCtx = document.getElementById('expense-chart').getContext('2d');
            if (expenseChart) expenseChart.destroy();
            
            expenseChart = new Chart(expenseCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Kebutuhan', 'Hiburan', 'Investasi', 'Lainnya'],
                    datasets: [{
                        data: [40, 25, 20, 15],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(249, 115, 22, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(156, 163, 175, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Sample data for income sources
            const incomeCtx = document.getElementById('income-chart').getContext('2d');
            if (incomeChart) incomeChart.destroy();
            
            incomeChart = new Chart(incomeCtx, {
                type: 'pie',
                data: {
                    labels: ['Gaji', 'Investasi', 'Freelance', 'Lainnya'],
                    datasets: [{
                        data: [60, 20, 15, 5],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(168, 85, 247, 0.8)',
                            'rgba(156, 163, 175, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Update graph charts
        function updateGraphCharts() {
            // Trend chart
            const trendCtx = document.getElementById('trend-chart').getContext('2d');
            if (trendChart) trendChart.destroy();
            
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                    datasets: [
                        {
                            label: 'Pemasukan',
                            data: [5000000, 6000000, 5500000, 7000000, 6500000, 8000000],
                            borderColor: 'rgba(34, 197, 94, 1)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Pengeluaran',
                            data: [4000000, 4500000, 5000000, 5500000, 5000000, 6000000],
                            borderColor: 'rgba(239, 68, 68, 1)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Comparison chart
            const comparisonCtx = document.getElementById('comparison-chart').getContext('2d');
            if (comparisonChart) comparisonChart.destroy();
            
            comparisonChart = new Chart(comparisonCtx, {
                type: 'bar',
                data: {
                    labels: ['2023 Q1', '2023 Q2', '2023 Q3', '2023 Q4', '2024 Q1'],
                    datasets: [
                        {
                            label: 'Pemasukan',
                            data: [15000000, 18000000, 16500000, 20000000, 22000000],
                            backgroundColor: 'rgba(34, 197, 94, 0.7)'
                        },
                        {
                            label: 'Pengeluaran',
                            data: [12000000, 14000000, 15000000, 16000000, 17000000],
                            backgroundColor: 'rgba(239, 68, 68, 0.7)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Forecast chart
            const forecastCtx = document.getElementById('forecast-chart').getContext('2d');
            if (forecastChart) forecastChart.destroy();
            
            forecastChart = new Chart(forecastCtx, {
                type: 'line',
                data: {
                    labels: ['Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'],
                    datasets: [
                        {
                            label: 'Proyeksi Pemasukan',
                            data: [8500000, 9000000, 9500000, 10000000, 10500000, 11000000],
                            borderColor: 'rgba(34, 197, 94, 1)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            borderDash: [5, 5],
                            tension: 0.4
                        },
                        {
                            label: 'Proyeksi Pengeluaran',
                            data: [6500000, 7000000, 7500000, 8000000, 8500000, 9000000],
                            borderColor: 'rgba(239, 68, 68, 1)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderDash: [5, 5],
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Update analysis data
        function updateAnalysisData() {
            // Update cash flow analysis
            document.getElementById('cash-ratio').textContent = '125%';
            document.getElementById('cash-days').textContent = '45 hari';
            document.getElementById('cash-trend').textContent = 'Meningkat';
            
            // Update health score
            document.getElementById('health-score').textContent = '85/100';
            document.getElementById('health-recommendation').textContent = 'Pertahankan';
            document.getElementById('health-status').textContent = 'Sehat';
            
            // Update insights
            const insightsContainer = document.getElementById('financial-insights');
            insightsContainer.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="bg-blue-100 p-2 rounded-full mt-1">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-blue-800 font-medium">Rasio Pemasukan/Pengeluaran sehat</p>
                        <p class="text-blue-700 text-sm mt-1">Pemasukan 25% lebih tinggi dari pengeluaran menunjukkan kesehatan keuangan yang baik</p>
                    </div>
                </div>
                <div class="flex items-start space-x-3">
                    <div class="bg-green-100 p-2 rounded-full mt-1">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-green-800 font-medium">Trend positif dalam 6 bulan terakhir</p>
                        <p class="text-green-700 text-sm mt-1">Pertumbuhan aset konsisten dengan peningkatan 15% dari kuartal sebelumnya</p>
                    </div>
                </div>
                <div class="flex items-start space-x-3">
                    <div class="bg-yellow-100 p-2 rounded-full mt-1">
                        <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-yellow-800 font-medium">Perhatikan diversifikasi investasi</p>
                        <p class="text-yellow-700 text-sm mt-1">70% aset terkonsentrasi pada satu jenis investasi, pertimbangkan diversifikasi</p>
                    </div>
                </div>
            `;
        }

        // Filter functionality
        transactionTypeFilter.addEventListener('change', () => {
            loadTransactions();
        });

        transactionCategoryFilter.addEventListener('change', () => {
            loadTransactions();
        });

        assetCategoryFilter.addEventListener('change', () => {
            loadAssets();
        });

        // Set today's date as default in the forms
        document.getElementById('transaction-date').valueAsDate = new Date();
        document.getElementById('asset-date').valueAsDate = new Date();

        // Initialize the app
        function initApp() {
            loadRecentTransactions();
            loadRecentAssets();
            loadTransactions();
            loadAssets();
            updateStats();
            updateChart();
            updateStatisticCharts();
            updateGraphCharts();
            updateAnalysisData();
        }

        // Run the app when the page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
